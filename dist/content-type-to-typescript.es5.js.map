{"version":3,"file":"content-type-to-typescript.es5.js","sources":["../src/built-in-definitions.ts","../src/parser.ts","../src/generator.ts"],"sourcesContent":["import { fromPairs, map } from 'lodash';\nimport { JSONSchema } from './types/json-schema';\n\nexport const Location: JSONSchema = {\n  title: 'Location',\n  properties: {\n    lon: {\n      type: 'number',\n      description: '',\n      additionalProperties: false,\n      required: [],\n    },\n    lat: {\n      type: 'number',\n      description: '',\n      additionalProperties: false,\n      required: [],\n    },\n  },\n  required: ['lat', 'lon'],\n  additionalProperties: false,\n};\n\nexport const AssetLink: JSONSchema = {\n  title: 'AssetLink',\n  properties: {\n    type: {\n      type: 'string',\n      description: '',\n      additionalProperties: false,\n      required: [],\n    },\n    linkType: {\n      type: 'string',\n      description: '',\n      additionalProperties: false,\n      required: [],\n    },\n    id: {\n      type: 'string',\n      additionalProperties: false,\n      required: [],\n    },\n  },\n  required: ['type', 'linkType', 'id'],\n  additionalProperties: false,\n};\n\nexport const EntryLink: JSONSchema = {\n  title: 'EntryLink',\n  properties: {\n    type: {\n      type: 'string',\n      description: '',\n      additionalProperties: false,\n      required: [],\n    },\n    linkType: {\n      type: 'string',\n      description: '',\n      additionalProperties: false,\n      required: [],\n    },\n    id: {\n      type: 'string',\n      additionalProperties: false,\n      required: [],\n    },\n  },\n  required: ['type', 'linkType', 'id'],\n  additionalProperties: false,\n};\n\nexport const buildRef = (schema: JSONSchema) => {\n  return `#/definitions/${schema.title}`;\n};\n\nexport const getByRef = (ref: string): JSONSchema => {\n  const lookup = fromPairs(map([Location, EntryLink, AssetLink], (def) => [buildRef(def), def]));\n\n  return lookup[ref];\n};\n","import { chain, deburr, trim, upperFirst } from 'lodash';\nimport { buildRef, Location } from './built-in-definitions';\nimport { ContentfulField, ContentType } from './types/contentful';\nimport { JSONSchema } from './types/json-schema';\n\nexport const toInterfaceName = (s: string, prefix: string): string => {\n  return (\n    prefix +\n    upperFirst(\n      // remove accents, umlauts, ... by their basic latin letters\n      deburr(s)\n        // replace chars which are not valid for typescript identifiers with whitespace\n        .replace(/(^\\s*[^a-zA-Z_$])|([^a-zA-Z_$\\d])/g, ' ')\n        // uppercase leading underscores followed by lowercase\n        .replace(/^_[a-z]/g, (match) => match.toUpperCase())\n        // remove non-leading underscores followed by lowercase (convert snake_case)\n        .replace(/_[a-z]/g, (match) => match.substr(1, match.length).toUpperCase())\n        // uppercase letters after digits, dollars\n        .replace(/([\\d$]+[a-zA-Z])/g, (match) => match.toUpperCase())\n        // uppercase first letter after whitespace\n        .replace(/\\s+([a-zA-Z])/g, (match) => {\n          return trim(match.toUpperCase());\n        })\n        // remove remaining whitespace\n        .replace(/\\s/g, ''),\n    )\n  );\n};\n\nfunction fieldToJsonSchema(fieldInfo: ContentfulField, prefix: string): any {\n  let result: any;\n  switch (fieldInfo.type) {\n    case 'Symbol':\n    case 'Text':\n    case 'RichText':\n    case 'Date':\n      result = {\n        type: 'string',\n      };\n      break;\n    case 'Number':\n    case 'Integer':\n      result = {\n        type: 'number',\n      };\n      break;\n    case 'Boolean':\n      result = {\n        type: 'boolean',\n      };\n      break;\n    case 'Location':\n      result = {\n        $ref: buildRef(Location),\n      };\n      break;\n    case 'Object':\n      result = {\n        type: 'object',\n      };\n      break;\n    case 'Array':\n      if (!fieldInfo.items) {\n        throw new Error('Unexpected Content Type structure.');\n      }\n      result = {\n        items: fieldToJsonSchema(fieldInfo.items, prefix),\n        type: 'array',\n      };\n      break;\n    case 'Link':\n      if (fieldInfo.linkType === 'Asset') {\n        result = {\n          tsType: `Asset`,\n        };\n      } else if (fieldInfo.linkType === 'Entry') {\n        let linkType = 'any';\n        if (fieldInfo.validations && fieldInfo.validations.length > 0) {\n          const validation = fieldInfo.validations.find((v) => {\n            return v.hasOwnProperty('linkContentType');\n          });\n          if (validation && validation.linkContentType && validation.linkContentType.length > 0) {\n            linkType = validation.linkContentType\n              .map((s: string) => {\n                return toInterfaceName(s, prefix);\n              })\n              .join(' | ');\n          }\n        }\n\n        result = {\n          tsType: `Entry<${linkType}>`,\n        };\n      } else {\n        throw new Error('Unexpected Content Type structure.');\n      }\n      break;\n    default:\n      throw new Error(`Type ${fieldInfo.type} is not yet supported`);\n  }\n\n  return result;\n}\n\nfunction transformFields(contentTypeInfo: Partial<ContentType>, prefix: string): JSONSchema {\n  const properties = chain(contentTypeInfo.fields)\n    .filter((fieldInfo) => !fieldInfo.omitted)\n    .map((fieldInfo) => [fieldInfo.id, fieldToJsonSchema(fieldInfo, prefix)])\n    .fromPairs()\n    .value();\n\n  const required = chain(contentTypeInfo.fields)\n    .filter((fieldInfo) => fieldInfo.required)\n    .map((fieldInfo) => fieldInfo.id)\n    .value();\n\n  return {\n    properties,\n    required,\n    additionalProperties: false,\n  };\n}\n\nexport function convertToJSONSchema(contentTypeInfo: ContentType, prefix: string): JSONSchema {\n  const resultSchema: JSONSchema = {\n    title: toInterfaceName(contentTypeInfo.sys.id, prefix),\n    description: contentTypeInfo.description,\n    ...transformFields(contentTypeInfo, prefix),\n  };\n\n  return resultSchema;\n}\n","import { ContentType } from 'contentful/index';\nimport { JSONSchema4 } from 'json-schema';\nimport { compile, Options } from 'json-schema-to-typescript';\nimport { chain, defaults, get, orderBy } from 'lodash';\nimport { buildRef, getByRef } from './built-in-definitions';\nimport { convertToJSONSchema } from './parser';\nimport { JSONSchema } from './types/json-schema';\n\nconst BANNER_COMMENT = `/**\n* This file was automatically generated.\n* DO NOT MODIFY IT BY HAND.\n*/`;\n\nexport async function compileFromContentTypes(\n  contentTypes: ContentType[],\n  options: Partial<Options> = {},\n  prefix: string = '',\n): Promise<string> {\n  const settings = defaults(\n    {\n      bannerComment: BANNER_COMMENT,\n    },\n    options,\n  );\n\n  const allDefinitions = includeRequiredDefinitions(\n    contentTypes.map((ct) => convertToJSONSchema(ct, prefix)),\n  );\n\n  const resultSchema = {\n    title: 'EphemeralContentfulSchemaRoot1',\n    type: 'object',\n    properties: chain(allDefinitions)\n      .map((def) => [def.title, { $ref: buildRef(def) }])\n      .fromPairs()\n      .value(),\n    definitions: chain(allDefinitions)\n      .map((def) => [def.title, def])\n      .fromPairs()\n      .value(),\n  };\n\n  const res = await compile(resultSchema as JSONSchema4, EPHEMERAL_ROOT, settings);\n\n  const contentFulTypeImport = 'import { Asset, Entry } from \\'contentful\\';';\n\n  return cleanupEphemeralRoot(contentFulTypeImport + res);\n}\n\nconst EPHEMERAL_ROOT = 'EphemeralContentfulSchemaRoot1';\n\nfunction cleanupEphemeralRoot(input: string): string {\n  return input.replace(new RegExp(`.+${EPHEMERAL_ROOT}.+[^{\\}]+(?=}).+\\n+`, 'gm'), '');\n}\n\nfunction getRefs(definition: JSONSchema): JSONSchema[] {\n  return chain(definition.properties)\n    .map((propSchema) => get(propSchema, '$ref'))\n    .compact()\n    .map((s) => getByRef(s))\n    .compact()\n    .value();\n}\n\nfunction includeRequiredDefinitions(definitions: JSONSchema[]): JSONSchema[] {\n  const requiredBuiltInDefinitions: JSONSchema[] = chain(definitions)\n    .map((def) => getRefs(def))\n    .flatten()\n    .value();\n\n  const alphabetizedDefinitions = orderBy(definitions, ['title'], ['asc']);\n\n  return alphabetizedDefinitions.concat(requiredBuiltInDefinitions);\n}\n"],"names":["fromPairs","map","upperFirst","deburr","trim","chain","defaults","compile","get","orderBy"],"mappings":"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"}